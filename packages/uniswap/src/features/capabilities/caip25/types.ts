import {
  EVM_NAMESPACE_IDENTIFIER,
  SOLANA_NAMESPACE_IDENTIFIER,
} from 'uniswap/src/features/capabilities/caip25/constants'

interface ChainScope {
  accounts: string[]
  chains?: string[]
  methods: string[]
  notifications: string[]
  capabilities?: {
    [key: string]: unknown
  }
  clientContext?: {
    directPrivateKeyAccess: boolean
    nextEvmUpgradeAddress?: string
  }
}

interface ChainScopeWithChains extends ChainScope {
  chains: string[]
}

export type CAIP25Namespace = typeof EVM_NAMESPACE_IDENTIFIER | typeof SOLANA_NAMESPACE_IDENTIFIER

export type MultipleChainsNamespaceScopeKey = CAIP25Namespace
type AnyChainInNamespaceScopeKey = `${CAIP25Namespace}:0`
export type SingleChainNamespaceScopeKey = `${CAIP25Namespace}:${string}`

/** @see https://chainagnostic.org/CAIPs/caip-25 */
export interface CAIP25CreateSessionResponse {
  id: number
  jsonrpc: string
  result: CAIP25Session
}

export interface CAIP25Session {
  sessionId?: string
  scopes: {
    [key in MultipleChainsNamespaceScopeKey]?: ChainScopeWithChains
  } & {
    [key in AnyChainInNamespaceScopeKey]?: ChainScope
  } & {
    [key in SingleChainNamespaceScopeKey]?: ChainScope
  }
  properties: {
    expiry: string
    walletInfo: CAIP372WalletInfo
  }
}

/** @see https://github.com/ChainAgnostic/CAIPs/pull/372 */
export type CAIP372WalletInfo = {
  /**
   * A globally unique identifier (UUIDv4) generated by the wallet provider to uniquely distinguish different wallet provider sessions that have otherwise matching properties.The cryptographic uniqueness of UUIDv4 ensures separate identification of independent sessions.
   */
  uuid: string
  /**
   * A human-readable name or alias of the wallet provider, suitable for display to the user (e.g., "Example Wallet Extension" or "Awesome Example Wallet").
   */
  name: string
  /**
   * A URI pointing to an image asset representing the wallet. The image SHOULD be square, with a minimum resolution of 96Ã—96px. SVG or PNG formats are recommended. The asset SHOULD be optimized for display on both light and dark backgrounds.
   */
  icon?: string
  /**
   * The reverse domain name string identifying the wallet provider (e.g., `com.example.wallet`). This is expected to remain stable throughout the lifetime of the wallet product. dApps MUST be prepared to handle values that are unknown, invalid, or potentially misleading, similar to handling user agent strings in web browsers.
   */
  rdns?: string
}
